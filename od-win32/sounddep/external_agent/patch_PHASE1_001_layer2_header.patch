--- a/od-win32/sounddep/audio_layer2.h
+++ b/od-win32/sounddep/audio_layer2.h
@@ -37,6 +37,13 @@ struct AudioDebugVars {
     
     // General
     uint64_t totalProcessCalls;
+    
+    // DIRECT WRITE MODE
+    double estimatedPaulaRateHz;
+    int inputBufferFrames;
+    int outputBufferFrames;
+    uint64_t pushSampleCalls;
+    uint64_t resampleCalls;
 };
 
 extern AudioDebugVars g_audioDebugVars;
@@ -61,6 +68,12 @@ public:
     // Вызывается из Layer 3 после открытия девайса
     bool Reconfigure(int hostBufferFrames);
     
+    // DIRECT WRITE MODE: Push single sample (replaces batched ProcessFromPaula)
+    // Called once per Paula sample from audio.cpp sample_handler
+    void PushSample(int16_t left, int16_t right, float cycles_per_sample);
+    
+    // LEGACY: Batched mode (kept for compatibility/fallback)
+    // Will be deprecated once direct write is validated
     // Processing (вызывается из Paula thread)
     // samples: int16_t stereo interleaved
     // frameCount: количество frames (не samples!)
@@ -92,7 +105,11 @@ private:
     int hostBufferFrames; // Размер буфера WASAPI в фреймах
     
     // Components (forward declared выше)
+    AudioRingBuffer<int16_t>* inputBuffer;   // NEW: Input buffer (raw Paula samples)
     AudioRingBuffer<float>* ringBuffer;
     AudioResampler* resampler;
     
     // Temporary buffer для resampler output
@@ -114,6 +131,20 @@ private:
     // Pre-roll
     bool isPreroll;
     int prerollThreshold; // В фреймах
+    
+    // DIRECT WRITE MODE: Rate measurement
+    struct RateMeasurement {
+        double currentRate;      // Current measured rate (Hz)
+        double emaRate;          // Smoothed rate estimate
+        int sampleCount;         // Samples processed
+        uint64_t lastLogTime;    // For periodic logging
+        
+        RateMeasurement() : currentRate(0.0), emaRate(0.0), sampleCount(0), lastLogTime(0) {}
+    } rateMeasurement;
+    
+    // Helper methods for direct write mode
+    void UpdateRateMeasurement(float cycles_per_sample);
+    void ResampleInputToOutput();
 };
 
 // Global instance (создается в sound.cpp)
